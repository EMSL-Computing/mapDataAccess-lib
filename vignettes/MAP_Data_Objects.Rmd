---
title: "MAP Data Objects"
author: "David J Degnan"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
library(mapDataAccess); library(data.tree)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

## Description

This markdown is to help users of mapDataAccess understand the project and midpoint
objects as well as their constructor and tagging functions. 

```{r}
knitr::include_graphics("./Object_Schema.png")
```

**Projects:** These are unprocessed, raw objects that were designed so that only 
one unique universal identifier (UUID) would need to be passed to open an app with data.

* **project_edata:** The simplest project object requires only an e_data file. Designed specifically for MODE only. 

* **project_pmart:** Requires an e_data and f_data file. Can be opened by pmart or MODE.

* **project_ipmart:** A complicated project object that must contain 2-5 objects of the the following classes: lipidomics (max 2), metabolomics (max 2: max 1 GC/LC-MS, max 1 NMR), and proteomics (peptide or protein, max 1). All of the objects within the project_ipmart object must be either project_pmart or midpoint_pmart exported from the same tab. Can be opened by ipmart or MODE.

**Midpoints:** These are pmartR partially or completely processed data objects. 

* **midpoint_pmart:** An object exported by pmart. Contains both the original project objects and the processed data. Data exported from an application can be opened in the subsequent tab. The order of possible tabs to export a midpoint from are Normalization, Peptide Statistics, Protein Rollup, and Statistics. A midpoint_pmart can be opened again in pmart or incorporated with other pmart_midpoints from the same tab into a project_ipmart object. Can be opened by pmart or MODE. 

* **midpoint_ipmart:** An object exported by ipmart. Contains 2-5 datasets processed through the Normalization, Statistics, and Integration tabs. Can be opened by ipmart or MODE.

## project_edata

```{r}
edataExample <- project_edata(projectname = "LipidToMode",
             datatype = "Lipidomics-Positive",
             edata = pmartRdata::lipid_edata,
             edata_filename = "lip_edata") 
class(edataExample) <- "list"
edataExample$Project$DataType <- edataExample$Project$DataType %>% as.list()
edataExample$Project$Name <- edataExample$Project$Name %>% as.list()
edataExample$Data$e_data_filename <- edataExample$Data$e_data_filename %>% as.list()
edataExample %>% data.tree::as.Node(nodeName = "project_edata") %>% plot()
```

**Components:**

* *Project:* A label indicating project components

    + *Name:* The name of the project. Extra spaces and characters are removed. 

    + *DataType:* One of the acceptable data types. Current examples are: Peptide-level Label Free, Peptide-level Isobaric, Protein-level Label Free, Protein-level Isobaric, Lipidomics-Negative, Lipidomics-Positive, Metabolomics-GC/LC-MS, and Metabolomics-NMR.
    
* *Data:* A label indicating data components

   + *e_data:* A data frame or data table containing the edata. 
   
   + *e_data_filename:* The name of the edata file that was uploaded.
   
**Tags:**   

Tags are assigned to every project and midpoint object in MAP. These are used to
quickly extract data about what has been uploaded.
   
```{r}
pull_tags_from_object(project_edata(projectname = "LipidToMode",
             datatype = "Lipidomics-Positive",
             edata = pmartRdata::lipid_edata,
             edata_filename = "lip_edata")) %>% as.data.frame() %>% knitr::kable()
```

## project_pmart

```{r}
pmart_example <- project_pmart(projectname = "My Peptide Data",
             datatype = "Peptide-level Label Free",
             edata = pmartRdata::pep_edata,
             fdata = pmartRdata::pep_fdata,
             emeta = pmartRdata::pep_emeta,
             edata_filename = "pep_edata",
             fdata_filename = "pep_fdata",
             emeta_filename = "pep_emeta")
class(pmart_example) <- "list"
pmart_example$Project$DataType <- pmart_example$Project$DataType %>% as.list()
pmart_example$Project$Name <- pmart_example$Project$Name %>% as.list()
pmart_example %>% data.tree::as.Node(nodeName = "project_pmart") %>% plot()
```

**Components:**

* *Project:* A label indicating project components

    + *Name:* The name of the project. Extra spaces and characters are removed. 

    + *DataType:* One of the acceptable data types. Current examples are: Peptide-level Label Free, Peptide-level Isobaric, Protein-level Label Free, Protein-level Isobaric, Lipidomics-Negative, Lipidomics-Positive, Metabolomics-GC/LC-MS, and Metabolomics-NMR.
    
* *Data:* A label indicating data components

   + *e_data/f_data/e_meta:* A data frame or data table containing the edata, fdata, or emeta.
   
   + *e_data/f_data/e_meta_filename:* (Not pictured) The name of the edata, fdata, or emeta file that was uploaded.
   
**Tags:** 

```{r}
pull_tags_from_object(project_pmart(projectname = "My Peptide Data",
             datatype = "Peptide-level Label Free",
             edata = pmartRdata::pep_edata,
             fdata = pmartRdata::pep_fdata,
             emeta = pmartRdata::pep_emeta,
             edata_filename = "pep_edata",
             fdata_filename = "pep_fdata",
             emeta_filename = "pep_emeta")) %>% as.data.frame() %>% knitr::kable()
```

## project_ipmart

